<html>
   
   <head>
      <script src = "http://ajax.googleapis.com/ajax/libs/angularjs/1.3.14/angular.min.js"></script>
   </head>
   
   <body ng-app = "myApp">
	
      <div ng-controller = "myCtrl">
         <input type = "file" file-model = "myFile"/>
         <button ng-click = "uploadFile()">upload me</button>
      </div>
      
      <script>
         var myApp = angular.module('myApp', []);
         
         myApp.directive('fileModel', ['$parse', function ($parse) {
            return {
               restrict: 'A',
               link: function(scope, element, attrs) {
                  var model = $parse(attrs.fileModel);
                  var modelSetter = model.assign;
                  
                  element.bind('change', function(){
                     scope.$apply(function(){
                        modelSetter(scope, element[0].files[0]);
                     });
                  });
               }
            };
         }]);
      
         myApp.service('fileUpload', ['$http', function ($http) {
            this.uploadFileToUrl = function(file, uploadUrl){
            	 alert('prcess en cours service');
               var fd = new FormData();
               fd.append('file', file);
            
               $http.post(uploadUrl, fd, {
                  transformRequest: angular.identity,
                  headers: {'Content-Type': undefined}
               })
            
               .success(function(){
            	   alert('success');
               })
            
               .error(function(){
            	   alert('error');
               });
            }
         }]);
    
         
         myApp.controller('myCtrl', ['$scope', 'fileUpload', function($scope, fileUpload){
            $scope.uploadFile = function(){
               var file = $scope.myFile;
               alert('prcess en cours controller');
               console.log('file is ' );
               console.dir(file);
               
               var uploadUrl = "upload";
               fileUpload.uploadFileToUrl(file, uploadUrl);
            };
         }]);
		
         //////////////
              //
//          var services = angular.module('myApp.services', ['ngResource']);
//          services.factory('fileUpload', function ($resource) {
//         	    return $resource('upload', {}, {
//         	        query: { method: 'GET', isArray: true },
//         	        this.uploadFileToUrl = function(file, uploadUrl){
//                    	 alert('prcess en cours service');
//                       var fd = new FormData();
//                       fd.append('file', file);
                   
//                       $http.post(uploadUrl, fd, {
//                          transformRequest: angular.identity,
//                          headers: {'Content-Type': undefined}
//                       })
                   
//                       .success(function(){
//                    	   alert('success');
//                       })
                   
//                       .error(function(){
//                    	   alert('error');
//                       });
//                    }
//         	    })
//         	});
         
//          var app = angular.module('myApp.controllers', []);
//          app.controller('myCtrl', ['$scope', 'fileUpload', '$location',
//          function ($scope, fileUpload, $location) {

//              // callback for ng-click 'createNewUser':
//              $scope.uploadFile = function () {
//             	 var file = $scope.myFile;
//                  alert('prcess en cours controller');
//                  console.log('file is ' );
//                  console.dir(file);
                 
//                  var uploadUrl = "upload";
//                  fileUpload.uploadFileToUrl(file);
//              }
//          }]);
       
      </script>
      
   </body>
</html>